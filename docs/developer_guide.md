# é–‹ç™ºè€…ã‚¬ã‚¤ãƒ‰

å–¶æ¥­ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ï¼‹åˆ†æãƒ¬ãƒãƒ¼ãƒˆè‡ªå‹•ç”Ÿæˆãƒ„ãƒ¼ãƒ«ã®é–‹ç™ºè€…å‘ã‘ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

---

## ç›®æ¬¡

1. [ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ¦‚è¦](#ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ¦‚è¦)
2. [æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯](#æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯)
3. [ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ ](#ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ )
4. [ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«è©³ç´°](#ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«è©³ç´°)
5. [é–‹ç™ºç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—](#é–‹ç™ºç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—)
6. [ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¦ç´„](#ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¦ç´„)
7. [ãƒ†ã‚¹ãƒˆ](#ãƒ†ã‚¹ãƒˆ)
8. [ãƒ‡ãƒ—ãƒ­ã‚¤](#ãƒ‡ãƒ—ãƒ­ã‚¤)
9. [æ‹¡å¼µæ–¹æ³•](#æ‹¡å¼µæ–¹æ³•)

---

## ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ¦‚è¦

### ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆå›³

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Streamlit UI (app.py)                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚Dashboardâ”‚ Data Preview â”‚ Prediction  â”‚ PDF Report  â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                     â”‚                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ data_processor â”‚  â”‚   visualizer    â”‚  â”‚    predictor    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ - load_csv()   â”‚  â”‚ - plot_sales_   â”‚  â”‚ - prepare_data()â”‚
â”‚ - merge_df()   â”‚  â”‚   trend()       â”‚  â”‚ - train()       â”‚
â”‚ - clean_data() â”‚  â”‚ - plot_product_ â”‚  â”‚ - predict()     â”‚
â”‚ - apply_        â”‚  â”‚   ranking()     â”‚  â”‚ - evaluate()    â”‚
â”‚   filters()    â”‚  â”‚ - plot_         â”‚  â”‚                 â”‚
â”‚ - export_to_   â”‚  â”‚   customer_     â”‚  â”‚                 â”‚
â”‚   excel()      â”‚  â”‚   analysis()    â”‚  â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ - etc (7 types) â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  pdf_generator    â”‚
                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                    â”‚ - add_summary_    â”‚
                    â”‚   section()       â”‚
                    â”‚ - add_chart_      â”‚
                    â”‚   section()       â”‚
                    â”‚ - generate_       â”‚
                    â”‚   report()        â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼

```
1. CSV Upload â†’ load_csv() â†’ pd.DataFrame
                     â†“
2. Validation â†’ validate_required_columns()
                     â†“
3. Cleaning â†’ clean_data() â†’ Cleaned DataFrame
                     â†“
4. â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚             â”‚             â”‚             â”‚
   â–¼             â–¼             â–¼             â–¼
Visualize    Predict     Export PDF   Export Excel
```

### ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†

Streamlitã®`st.session_state`ã§ãƒ‡ãƒ¼ã‚¿ã‚’æ°¸ç¶šåŒ–ï¼š

```python
if 'data' not in st.session_state:
    st.session_state.data = None

# ãƒ‡ãƒ¼ã‚¿ä¿å­˜
st.session_state.data = df

# ãƒ‡ãƒ¼ã‚¿å–å¾—
df = st.session_state.data
```

---

## æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

### ã‚³ã‚¢ãƒ©ã‚¤ãƒ–ãƒ©ãƒª

| ãƒ©ã‚¤ãƒ–ãƒ©ãƒª | ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | ç”¨é€” |
|-----------|-----------|------|
| **streamlit** | 1.28.0 | Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ |
| **pandas** | 2.1.1 | ãƒ‡ãƒ¼ã‚¿å‡¦ç†ãƒ»åˆ†æ |
| **plotly** | 5.17.0 | ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ã‚°ãƒ©ãƒ•ç”Ÿæˆ |
| **scikit-learn** | 1.3.1 | æ©Ÿæ¢°å­¦ç¿’ï¼ˆç·šå½¢å›å¸°ï¼‰ |
| **fpdf2** | 2.7.6 | PDFãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ |
| **openpyxl** | 3.1.2 | Excelãƒ•ã‚¡ã‚¤ãƒ«å‡ºåŠ› |
| **kaleido** | 0.2.1 | Plotlyã‚°ãƒ©ãƒ•ã®ç”»åƒå¤‰æ› |
| **Pillow** | 10.0.1 | ç”»åƒå‡¦ç† |

### é¸å®šç†ç”±

**Streamlit:**
- Pythonã®ã¿ã§å®Œçµã™ã‚‹Webã‚¢ãƒ—ãƒªé–‹ç™º
- ãƒ›ãƒƒãƒˆãƒªãƒ­ãƒ¼ãƒ‰å¯¾å¿œã§é–‹ç™ºåŠ¹ç‡ãŒé«˜ã„
- ãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚¨ãƒ³ã‚¹å‘ã‘ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒè±Šå¯Œ

**Plotly:**
- ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ã‚°ãƒ©ãƒ•ï¼ˆã‚ºãƒ¼ãƒ ãƒ»ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãƒ»ãƒ›ãƒãƒ¼ï¼‰
- Streamlitã¨ã®ç›¸æ€§ãŒè‰¯ã„
- PNGç”»åƒã¨ã—ã¦ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆå¯èƒ½

**scikit-learn:**
- ã‚·ãƒ³ãƒ—ãƒ«ãªAPI
- ç·šå½¢å›å¸°ãƒ¢ãƒ‡ãƒ«ãŒç°¡å˜ã«å®Ÿè£…ã§ãã‚‹
- äºˆæ¸¬ç²¾åº¦è©•ä¾¡ãƒ¡ãƒˆãƒªã‚¯ã‚¹ãŒå……å®Ÿ

**fpdf2:**
- Python 3å¯¾å¿œï¼ˆfpdfã®å¾Œç¶™ï¼‰
- æ—¥æœ¬èªãƒ•ã‚©ãƒ³ãƒˆå¯¾å¿œ
- ç”»åƒåŸ‹ã‚è¾¼ã¿ãŒç°¡å˜

---

## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ 

```
sales_dashboard/
â”œâ”€â”€ app.py                       # ãƒ¡ã‚¤ãƒ³ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³
â”œâ”€â”€ requirements.txt             # ä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸
â”œâ”€â”€ README.md                    # ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆèª¬æ˜
â”œâ”€â”€ CLAUDE.md                    # ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè¨­è¨ˆæ›¸
â”œâ”€â”€ .gitignore                   # Gité™¤å¤–è¨­å®š
â”‚
â”œâ”€â”€ src/                         # ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ data_processor.py        # ãƒ‡ãƒ¼ã‚¿å‡¦ç†ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«
â”‚   â”œâ”€â”€ visualizer.py            # ã‚°ãƒ©ãƒ•ç”Ÿæˆãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«
â”‚   â”œâ”€â”€ predictor.py             # å£²ä¸Šäºˆæ¸¬ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«
â”‚   â””â”€â”€ pdf_generator.py         # PDFãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«
â”‚
â”œâ”€â”€ data/                        # ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚©ãƒ«ãƒ€
â”‚   â”œâ”€â”€ sample/                  # ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿
â”‚   â”‚   â””â”€â”€ Sample - Superstore.csv
â”‚   â””â”€â”€ uploads/                 # ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿ï¼ˆ.gitignoreï¼‰
â”‚
â”œâ”€â”€ assets/                      # é™çš„ãƒ•ã‚¡ã‚¤ãƒ«
â”‚   â”œâ”€â”€ logo.png                 # ãƒ­ã‚´ç”»åƒ
â”‚   â””â”€â”€ styles.css               # ã‚«ã‚¹ã‚¿ãƒ CSSï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
â”‚
â”œâ”€â”€ outputs/                     # å‡ºåŠ›ãƒ•ã‚©ãƒ«ãƒ€
â”‚   â””â”€â”€ reports/                 # PDFãƒ¬ãƒãƒ¼ãƒˆï¼ˆ.gitignoreï¼‰
â”‚
â””â”€â”€ docs/                        # ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
    â”œâ”€â”€ images/                  # ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ
    â”œâ”€â”€ user_guide.md            # ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¬ã‚¤ãƒ‰
    â”œâ”€â”€ developer_guide.md       # é–‹ç™ºè€…ã‚¬ã‚¤ãƒ‰ï¼ˆã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰
    â”œâ”€â”€ test_results.md          # ãƒ†ã‚¹ãƒˆçµæœ
    â””â”€â”€ 01_ï½13_.md              # å®Ÿè£…ãƒã‚±ãƒƒãƒˆ
```

---

## ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«è©³ç´°

### 1. `app.py` - ãƒ¡ã‚¤ãƒ³ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³

**è²¬å‹™:**
- Streamlitãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆå®šç¾©
- ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰UI
- å„ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®å‘¼ã³å‡ºã—
- ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚¹ãƒ†ãƒ¼ãƒˆç®¡ç†

**ä¸»è¦ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ:**

```python
# ãƒšãƒ¼ã‚¸è¨­å®š
st.set_page_config(page_title="å£²ä¸Šãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰", layout="wide")

# ã‚µã‚¤ãƒ‰ãƒãƒ¼
with st.sidebar:
    uploaded_files = st.file_uploader("CSV Upload", accept_multiple_files=True)

# ãƒ¡ã‚¤ãƒ³ã‚¨ãƒªã‚¢ï¼ˆã‚¿ãƒ–ï¼‰
tab1, tab2, tab3, tab4 = st.tabs(["ğŸ“ˆ ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰", "ğŸ“Š ãƒ‡ãƒ¼ã‚¿ç¢ºèª", "ğŸ”® å£²ä¸Šäºˆæ¸¬", "ğŸ“„ ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ"])

with tab1:
    # ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰å®Ÿè£…

with tab2:
    # ãƒ‡ãƒ¼ã‚¿ç¢ºèªå®Ÿè£…

# ...
```

**ã‚­ãƒ¼ãƒã‚¤ãƒ³ãƒˆ:**
- `st.session_state` ã§ãƒ‡ãƒ¼ã‚¿ã‚’æ°¸ç¶šåŒ–
- `@st.cache_data` ã§ã‚°ãƒ©ãƒ•ç”Ÿæˆã‚’é«˜é€ŸåŒ–
- `st.spinner()` ã§ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤º

---

### 2. `src/data_processor.py` - ãƒ‡ãƒ¼ã‚¿å‡¦ç†

**è²¬å‹™:**
- CSVèª­ã¿è¾¼ã¿ï¼ˆè¤‡æ•°ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°å¯¾å¿œï¼‰
- è¤‡æ•°ãƒ•ã‚¡ã‚¤ãƒ«çµ±åˆ
- ãƒ‡ãƒ¼ã‚¿ã‚¯ãƒªãƒ¼ãƒ‹ãƒ³ã‚°
- ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼é©ç”¨
- Excelå‡ºåŠ›

**ä¸»è¦é–¢æ•°:**

#### `load_csv(file) -> pd.DataFrame`

```python
def load_csv(file) -> pd.DataFrame:
    """CSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã¿DataFrameã‚’è¿”ã™

    - ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è‡ªå‹•æ¤œå‡ºï¼ˆUTF-8/Shift-JIS/ISO-8859-1ï¼‰
    - ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºãƒã‚§ãƒƒã‚¯
    - å¿…é ˆã‚«ãƒ©ãƒ ãƒã‚§ãƒƒã‚¯
    """
```

**å®Ÿè£…è©³ç´°:**
- è¤‡æ•°ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚’é †ç•ªã«è©¦è¡Œ
- `DataValidationError` ã§ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ã‚’æ•æ‰
- ãƒ­ã‚¬ãƒ¼ã§è©³ç´°ãƒ­ã‚°ã‚’å‡ºåŠ›

#### `clean_data(df) -> pd.DataFrame`

```python
def clean_data(df: pd.DataFrame) -> pd.DataFrame:
    """ãƒ‡ãƒ¼ã‚¿ã‚¯ãƒªãƒ¼ãƒ‹ãƒ³ã‚°ã‚’å®Ÿè¡Œ

    - æ—¥ä»˜ã‚«ãƒ©ãƒ ã®ãƒ‘ãƒ¼ã‚¹
    - æ•°å€¤ã‚«ãƒ©ãƒ ã®å‹å¤‰æ›
    - æ¬ æå€¤ãƒã‚§ãƒƒã‚¯
    - é‡è¤‡è¡Œå‰Šé™¤
    """
```

**ãƒ‡ãƒ¼ã‚¿ã‚¯ãƒªãƒ¼ãƒ‹ãƒ³ã‚°ãƒ•ãƒ­ãƒ¼:**
1. æ—¥ä»˜ã‚«ãƒ©ãƒ : `pd.to_datetime(errors='coerce')`
2. æ•°å€¤ã‚«ãƒ©ãƒ : `pd.to_numeric(errors='coerce')`
3. æ¬ æå€¤: ãƒ­ã‚°ã«è­¦å‘Šå‡ºåŠ›ï¼ˆå‰Šé™¤ã¯ã—ãªã„ï¼‰
4. é‡è¤‡è¡Œ: `df.drop_duplicates()`

---

### 3. `src/visualizer.py` - ã‚°ãƒ©ãƒ•ç”Ÿæˆ

**è²¬å‹™:**
- 7ç¨®é¡ã®Plotlyã‚°ãƒ©ãƒ•ç”Ÿæˆ
- å…±é€šãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆé©ç”¨
- ãƒ‡ãƒ¼ã‚¿ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³

**ä¸»è¦é–¢æ•°:**

#### `plot_sales_trend(df, period='daily')`

```python
def plot_sales_trend(df: pd.DataFrame, period: Literal['daily', 'monthly', 'yearly'] = 'daily'):
    """æ—¥æ¬¡/æœˆæ¬¡/å¹´æ¬¡å£²ä¸Šæ¨ç§»ã‚’æŠ˜ã‚Œç·šã‚°ãƒ©ãƒ•ã§è¡¨ç¤º"""
```

**ã‚°ãƒ©ãƒ•ä¸€è¦§:**

| é–¢æ•°å | ã‚°ãƒ©ãƒ•ç¨®é¡ | å¿…é ˆã‚«ãƒ©ãƒ  |
|--------|-----------|-----------|
| `plot_sales_trend()` | æŠ˜ã‚Œç·šã‚°ãƒ©ãƒ• | Order Date, Sales |
| `plot_product_ranking()` | æ¨ªæ£’ã‚°ãƒ©ãƒ• | Product Name, Sales |
| `plot_customer_analysis()` | æ•£å¸ƒå›³ | Customer Name, Sales, Profit, Segment |
| `plot_yoy_comparison()` | ã‚°ãƒ«ãƒ¼ãƒ—åŒ–æ£’ã‚°ãƒ©ãƒ• | Order Date, Sales |
| `plot_regional_sales()` | å††ã‚°ãƒ©ãƒ• | Region, Sales |
| `plot_category_breakdown()` | ç©ã¿ä¸Šã’æ£’ã‚°ãƒ©ãƒ• | Order Date, Category, Sales |
| `plot_profit_margin()` | æ•£å¸ƒå›³ | Product Name, Sales, Profit |

**å…±é€šãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆè¨­å®š:**

```python
def apply_common_layout(fig, title: str):
    fig.update_layout(
        template='plotly_white',
        hovermode='x unified',
        showlegend=True,
        height=400,
        title_font_size=14,
        plot_bgcolor='#FAFBFC',
        # ...
    )
```

---

### 4. `src/predictor.py` - å£²ä¸Šäºˆæ¸¬

**è²¬å‹™:**
- ãƒ‡ãƒ¼ã‚¿å‰å‡¦ç†
- ãƒ¢ãƒ‡ãƒ«è¨“ç·´
- å°†æ¥äºˆæ¸¬
- ç²¾åº¦è©•ä¾¡

**ã‚¯ãƒ©ã‚¹æ§‹é€ :**

```python
class SalesPredictor:
    def __init__(self):
        self.model = LinearRegression()
        self.is_trained = False
        self.date_origin = None
        self.last_training_date = None

    def prepare_data(self, df, date_col, sales_col) -> Tuple[X, y, daily_df]:
        """ãƒ‡ãƒ¼ã‚¿å‰å‡¦ç†"""

    def train(self, X, y):
        """ãƒ¢ãƒ‡ãƒ«è¨“ç·´"""

    def predict(self, periods=30) -> pd.DataFrame:
        """å°†æ¥äºˆæ¸¬"""

    def evaluate(self, y_true, y_pred) -> dict:
        """ç²¾åº¦è©•ä¾¡"""
```

**ç‰¹å¾´é‡:**
- `DaysFromOrigin`: èµ·ç‚¹æ—¥ã‹ã‚‰ã®çµŒéæ—¥æ•°
- `DayOfWeek`: æ›œæ—¥ï¼ˆ0=æœˆæ›œ, 6=æ—¥æ›œï¼‰
- `Month`: æœˆï¼ˆ1-12ï¼‰
- `Quarter`: å››åŠæœŸï¼ˆ1-4ï¼‰
- `DayOfMonth`: æœˆã®æ—¥ï¼ˆ1-31ï¼‰
- `IsWeekend`: é€±æœ«ãƒ•ãƒ©ã‚°ï¼ˆ0/1ï¼‰

**äºˆæ¸¬ãƒ•ãƒ­ãƒ¼:**
1. æ—¥æ¬¡å£²ä¸Šã«é›†è¨ˆ
2. æ¬ ææ—¥ã‚’0ã§è£œå®Œ
3. ç‰¹å¾´é‡ä½œæˆ
4. ç·šå½¢å›å¸°ãƒ¢ãƒ‡ãƒ«è¨“ç·´
5. å°†æ¥æ—¥ä»˜ã‚’ç”Ÿæˆ
6. äºˆæ¸¬å®Ÿè¡Œï¼ˆè² ã®å€¤ã¯0ã«ã‚¯ãƒªãƒƒãƒ—ï¼‰

---

### 5. `src/pdf_generator.py` - PDFãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ

**è²¬å‹™:**
- PDFãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ
- ã‚°ãƒ©ãƒ•ã®PNGå¤‰æ›
- æ—¥æœ¬èªãƒ•ã‚©ãƒ³ãƒˆå¯¾å¿œ

**ã‚¯ãƒ©ã‚¹æ§‹é€ :**

```python
class ModernPDFReport(FPDF):
    def __init__(self):
        super().__init__()
        self.font_name = 'Helvetica'  # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ•ã‚©ãƒ³ãƒˆ
        self.font_loaded = False

    def header(self):
        """ãƒ˜ãƒƒãƒ€ãƒ¼ï¼ˆãƒ­ã‚´ã€ã‚¿ã‚¤ãƒˆãƒ«ï¼‰"""

    def footer(self):
        """ãƒ•ãƒƒã‚¿ãƒ¼ï¼ˆãƒšãƒ¼ã‚¸ç•ªå·ï¼‰"""

    def add_summary_section(self, data):
        """ã‚µãƒãƒªãƒ¼ã‚»ã‚¯ã‚·ãƒ§ãƒ³"""

    def add_chart_section(self, fig, title):
        """ã‚°ãƒ©ãƒ•ã‚»ã‚¯ã‚·ãƒ§ãƒ³"""

    def generate_report(self, output_path):
        """ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ"""
```

**Plotly â†’ PNGå¤‰æ›:**

```python
import plotly.io as pio

img_bytes = pio.to_image(fig, format='png', width=800, height=400, engine='kaleido')
```

**æ—¥æœ¬èªãƒ•ã‚©ãƒ³ãƒˆå¯¾å¿œ:**

```python
try:
    self.add_font('IPAGothic', '', 'ipaexg.ttf', uni=True)
    self.font_name = 'IPAGothic'
except Exception as e:
    logger.warning(f"ãƒ•ã‚©ãƒ³ãƒˆèª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼: {e}. Helveticaã‚’ä½¿ç”¨ã—ã¾ã™ã€‚")
    self.font_name = 'Helvetica'
```

---

## é–‹ç™ºç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

### 1. ãƒªãƒã‚¸ãƒˆãƒªã®ã‚¯ãƒ­ãƒ¼ãƒ³

```bash
git clone <repository-url>
cd sales_dashboard
```

### 2. ä»®æƒ³ç’°å¢ƒã®ä½œæˆ

```bash
# Windows
python -m venv venv
venv\Scripts\activate

# macOS/Linux
python3 -m venv venv
source venv/bin/activate
```

### 3. ä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
pip install -r requirements.txt
```

### 4. é–‹ç™ºç”¨ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

```bash
pip install black flake8 pytest
```

### 5. ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³èµ·å‹•

```bash
streamlit run app.py
```

---

## ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¦ç´„

### Python ã‚¹ã‚¿ã‚¤ãƒ«ã‚¬ã‚¤ãƒ‰

**PEP 8æº–æ‹ ** + Google Docstringå½¢å¼

#### docstring

```python
def function_name(arg1: type, arg2: type) -> return_type:
    """é–¢æ•°ã®ç°¡æ½”ãªèª¬æ˜ï¼ˆ1è¡Œï¼‰

    è©³ç´°ãªèª¬æ˜ï¼ˆå¿…è¦ãªå ´åˆï¼‰

    Args:
        arg1: å¼•æ•°1ã®èª¬æ˜
        arg2: å¼•æ•°2ã®èª¬æ˜

    Returns:
        æˆ»ã‚Šå€¤ã®èª¬æ˜

    Raises:
        ValueError: ã‚¨ãƒ©ãƒ¼ã®èª¬æ˜
    """
```

#### å‘½åè¦å‰‡

- **é–¢æ•°ãƒ»å¤‰æ•°**: ã‚¹ãƒãƒ¼ã‚¯ã‚±ãƒ¼ã‚¹ (`load_csv`, `sales_data`)
- **ã‚¯ãƒ©ã‚¹**: ãƒ‘ã‚¹ã‚«ãƒ«ã‚±ãƒ¼ã‚¹ (`SalesPredictor`, `ModernPDFReport`)
- **å®šæ•°**: å¤§æ–‡å­—ã‚¹ãƒãƒ¼ã‚¯ã‚±ãƒ¼ã‚¹ (`MAX_FILE_SIZE_MB`, `REQUIRED_COLUMNS`)

#### ã‚¤ãƒ³ãƒãƒ¼ãƒˆé †åº

```python
# 1. æ¨™æº–ãƒ©ã‚¤ãƒ–ãƒ©ãƒª
import os
import logging
from datetime import datetime

# 2. ã‚µãƒ¼ãƒ‰ãƒ‘ãƒ¼ãƒ†ã‚£ãƒ©ã‚¤ãƒ–ãƒ©ãƒª
import pandas as pd
import numpy as np
import streamlit as st

# 3. ãƒ­ãƒ¼ã‚«ãƒ«ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«
from src.data_processor import load_csv
from src.visualizer import plot_sales_trend
```

### ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

```python
try:
    df = load_csv(file)
except DataValidationError as e:
    st.error(f"âŒ {e}")
    return
except Exception as e:
    logger.error(f"äºˆæœŸã—ãªã„ã‚¨ãƒ©ãƒ¼: {e}")
    st.error("ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ")
    return
```

### ãƒ­ã‚®ãƒ³ã‚°

```python
import logging

logger = logging.getLogger(__name__)
logger.setLevel(logging.INFO)

logger.info("å‡¦ç†é–‹å§‹")
logger.warning("è­¦å‘Šãƒ¡ãƒƒã‚»ãƒ¼ã‚¸")
logger.error("ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸")
```

---

## ãƒ†ã‚¹ãƒˆ

### æ‰‹å‹•ãƒ†ã‚¹ãƒˆ

**ãƒ†ã‚¹ãƒˆé …ç›®**: `docs/12_ãƒ†ã‚¹ãƒˆ_å‹•ä½œç¢ºèª.md` å‚ç…§

### ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆï¼ˆæ¨å¥¨ï¼‰

```python
# tests/test_data_processor.py
import pytest
import pandas as pd
from src.data_processor import load_csv, clean_data

def test_load_csv_valid_file():
    df = load_csv('data/sample/Sample - Superstore.csv')
    assert len(df) > 0
    assert 'Sales' in df.columns

def test_clean_data():
    df = pd.DataFrame({
        'Order Date': ['2024-01-01', '2024-01-02'],
        'Sales': ['100', '200']
    })
    cleaned_df = clean_data(df)
    assert cleaned_df['Sales'].dtype == 'float64'
```

**ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ:**

```bash
pytest tests/
```

---

## ãƒ‡ãƒ—ãƒ­ã‚¤

### Streamlit Cloud

1. **GitHubãƒªãƒã‚¸ãƒˆãƒªã«push**

```bash
git add .
git commit -m "Initial commit"
git push origin main
```

2. **Streamlit Cloudã«ãƒ­ã‚°ã‚¤ãƒ³**

https://streamlit.io/cloud

3. **ã‚¢ãƒ—ãƒªã‚’ãƒ‡ãƒ—ãƒ­ã‚¤**

- ã€ŒNew appã€ã‚’ã‚¯ãƒªãƒƒã‚¯
- ãƒªãƒã‚¸ãƒˆãƒªã€ãƒ–ãƒ©ãƒ³ãƒã€`app.py` ã‚’é¸æŠ
- ã€ŒDeploy!ã€ã‚’ã‚¯ãƒªãƒƒã‚¯

### Heroku

```bash
# Procfile
web: sh setup.sh && streamlit run app.py
```

```bash
# setup.sh
mkdir -p ~/.streamlit/

echo "\
[server]\n\
headless = true\n\
port = $PORT\n\
enableCORS = false\n\
\n\
" > ~/.streamlit/config.toml
```

### Docker

```dockerfile
FROM python:3.9-slim

WORKDIR /app

COPY requirements.txt .
RUN pip install -r requirements.txt

COPY . .

EXPOSE 8501

CMD ["streamlit", "run", "app.py"]
```

---

## æ‹¡å¼µæ–¹æ³•

### æ–°ã—ã„ã‚°ãƒ©ãƒ•ã‚’è¿½åŠ ã™ã‚‹

#### 1. `src/visualizer.py` ã«é–¢æ•°ã‚’è¿½åŠ 

```python
def plot_new_graph(df: pd.DataFrame):
    """æ–°ã—ã„ã‚°ãƒ©ãƒ•ã®èª¬æ˜

    Args:
        df: ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ¬ãƒ¼ãƒ ï¼ˆ'Column1', 'Column2'ã‚«ãƒ©ãƒ å¿…é ˆï¼‰

    Returns:
        fig: Plotly figure ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
    """
    # ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
    validate_dataframe_for_plot(df, required_columns=['Column1', 'Column2'])

    # ã‚°ãƒ©ãƒ•ä½œæˆ
    fig = px.bar(df, x='Column1', y='Column2')

    # ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆé©ç”¨
    fig = apply_common_layout(fig, "æ–°ã—ã„ã‚°ãƒ©ãƒ•")

    return fig
```

#### 2. `app.py` ã®ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‚¿ãƒ–ã«è¿½åŠ 

```python
# ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‚¿ãƒ–
with tab1:
    # æ—¢å­˜ã®ã‚°ãƒ©ãƒ•...

    # æ–°ã—ã„ã‚°ãƒ©ãƒ•
    st.subheader("æ–°ã—ã„ã‚°ãƒ©ãƒ•")
    fig_new = plot_new_graph(df)
    st.plotly_chart(fig_new, use_container_width=True)
```

### æ–°ã—ã„äºˆæ¸¬ãƒ¢ãƒ‡ãƒ«ã‚’è¿½åŠ ã™ã‚‹

#### 1. `src/predictor.py` ã«æ–°ã—ã„ã‚¯ãƒ©ã‚¹ã‚’è¿½åŠ 

```python
from prophet import Prophet  # Facebook Prophet

class ProphetPredictor:
    def __init__(self):
        self.model = Prophet()

    def train(self, df):
        # Prophetç”¨ã®ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆå¤‰æ›
        prophet_df = df.rename(columns={'Order Date': 'ds', 'Sales': 'y'})
        self.model.fit(prophet_df)

    def predict(self, periods=30):
        future = self.model.make_future_dataframe(periods=periods)
        forecast = self.model.predict(future)
        return forecast
```

#### 2. `app.py` ã§äºˆæ¸¬ãƒ¢ãƒ‡ãƒ«ã‚’é¸æŠã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹

```python
model_type = st.selectbox("äºˆæ¸¬ãƒ¢ãƒ‡ãƒ«", ["ç·šå½¢å›å¸°", "Prophet"])

if model_type == "ç·šå½¢å›å¸°":
    predictor = SalesPredictor()
else:
    predictor = ProphetPredictor()
```

### ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼æ©Ÿèƒ½ã‚’è¿½åŠ ã™ã‚‹

#### 1. ã‚µã‚¤ãƒ‰ãƒãƒ¼ã«ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼UIã‚’è¿½åŠ 

```python
with st.sidebar:
    st.subheader("ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼")

    # æ—¥ä»˜ç¯„å›²
    date_range = st.date_input(
        "æ—¥ä»˜ç¯„å›²",
        value=(df['Order Date'].min(), df['Order Date'].max())
    )

    # ã‚«ãƒ†ã‚´ãƒª
    categories = st.multiselect(
        "ã‚«ãƒ†ã‚´ãƒª",
        options=df['Category'].unique(),
        default=df['Category'].unique()
    )
```

#### 2. `apply_filters()` ã‚’å‘¼ã³å‡ºã™

```python
filters = {
    'date_range': date_range,
    'categories': categories
}

filtered_df = apply_filters(df, filters)
```

---

## APIä»•æ§˜

### data_processor.py

| é–¢æ•°å | å¼•æ•° | æˆ»ã‚Šå€¤ | èª¬æ˜ |
|--------|------|--------|------|
| `load_csv(file)` | file: ãƒ•ã‚¡ã‚¤ãƒ«ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¾ãŸã¯ãƒ‘ã‚¹ | pd.DataFrame | CSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã¿ |
| `merge_dataframes(dfs)` | dfs: DataFrameã®ãƒªã‚¹ãƒˆ | pd.DataFrame | è¤‡æ•°DataFrameã‚’çµ±åˆ |
| `clean_data(df)` | df: DataFrame | pd.DataFrame | ãƒ‡ãƒ¼ã‚¿ã‚¯ãƒªãƒ¼ãƒ‹ãƒ³ã‚° |
| `apply_filters(df, filters)` | df: DataFrame, filters: dict | pd.DataFrame | ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚° |
| `export_to_excel(df)` | df: DataFrame | bytes | Excelå‡ºåŠ› |

### visualizer.py

ã™ã¹ã¦ã®ã‚°ãƒ©ãƒ•é–¢æ•°ã¯ `fig: plotly.graph_objects.Figure` ã‚’è¿”ã™

| é–¢æ•°å | å¼•æ•° | èª¬æ˜ |
|--------|------|------|
| `plot_sales_trend(df, period)` | df, period='daily'/'monthly'/'yearly' | å£²ä¸Šæ¨ç§» |
| `plot_product_ranking(df, top_n)` | df, top_n=10 | å•†å“ãƒ©ãƒ³ã‚­ãƒ³ã‚° |
| `plot_customer_analysis(df)` | df | é¡§å®¢åˆ†æ |
| `plot_yoy_comparison(df)` | df | å‰å¹´åŒæœˆæ¯”è¼ƒ |
| `plot_regional_sales(df)` | df | åœ°åŸŸåˆ¥å£²ä¸Š |
| `plot_category_breakdown(df)` | df | ã‚«ãƒ†ã‚´ãƒªåˆ¥æ¨ç§» |
| `plot_profit_margin(df)` | df | åˆ©ç›Šç‡åˆ†æ |

### predictor.py

| ãƒ¡ã‚½ãƒƒãƒ‰å | å¼•æ•° | æˆ»ã‚Šå€¤ | èª¬æ˜ |
|-----------|------|--------|------|
| `prepare_data(df, date_col, sales_col)` | df, date_col, sales_col | (X, y, daily_df) | ãƒ‡ãƒ¼ã‚¿å‰å‡¦ç† |
| `train(X, y)` | X: DataFrame, y: Series | None | ãƒ¢ãƒ‡ãƒ«è¨“ç·´ |
| `predict(periods)` | periods: int | DataFrame | å°†æ¥äºˆæ¸¬ |
| `evaluate(y_true, y_pred)` | y_true, y_pred | dict | ç²¾åº¦è©•ä¾¡ |

### pdf_generator.py

| ãƒ¡ã‚½ãƒƒãƒ‰å | å¼•æ•° | èª¬æ˜ |
|-----------|------|------|
| `add_summary_section(data)` | data: dict | ã‚µãƒãƒªãƒ¼è¿½åŠ  |
| `add_chart_section(fig, title)` | fig, title: str | ã‚°ãƒ©ãƒ•è¿½åŠ  |
| `generate_report(output_path)` | output_path: str | ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ |

---

## ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

### ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®æ´»ç”¨

```python
@st.cache_data
def load_and_clean_data(file):
    df = load_csv(file)
    df = clean_data(df)
    return df
```

### ãƒ‡ãƒ¼ã‚¿é‡ã®åˆ¶é™

å¤§å®¹é‡ãƒ‡ãƒ¼ã‚¿ï¼ˆ10ä¸‡è¡Œä»¥ä¸Šï¼‰ã¯å‡¦ç†ãŒé…ããªã‚‹ãŸã‚ï¼š
- ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°: `df.sample(n=10000)`
- é›†è¨ˆ: æ—¥æ¬¡â†’æœˆæ¬¡ã«é›†è¨ˆã—ã¦ã‹ã‚‰è¡¨ç¤º

### ã‚°ãƒ©ãƒ•æç”»ã®æœ€é©åŒ–

Plotlyã®ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°æ©Ÿèƒ½ã‚’ä½¿ç”¨ï¼š

```python
fig.update_traces(marker=dict(maxdisplayed=1000))
```

---

**é–‹ç™ºè€…ã‚¬ã‚¤ãƒ‰ã®æœ€çµ‚æ›´æ–°æ—¥**: 2025-10-10
