# ユーザーガイド

営業ダッシュボード＋分析レポート自動生成ツールの使い方を詳しく説明します。

---

## 目次

1. [はじめに](#はじめに)
2. [アプリケーションの起動](#アプリケーションの起動)
3. [データのアップロード](#データのアップロード)
4. [ダッシュボードの使い方](#ダッシュボードの使い方)
5. [データ確認タブ](#データ確認タブ)
6. [売上予測タブ](#売上予測タブ)
7. [PDFレポート生成タブ](#PDFレポート生成タブ)
8. [よくある質問（FAQ)](#よくある質問FAQ)
9. [トラブルシューティング](#トラブルシューティング)

---

## はじめに

このアプリケーションは、CSVファイルから売上データを読み込み、以下の機能を提供します：

- **インタラクティブダッシュボード**: 7種類のグラフで売上を可視化
- **売上予測**: 線形回帰モデルで将来の売上を予測
- **PDFレポート自動生成**: モダンなデザインのレポートを自動作成
- **Excelダウンロード**: 統合されたデータをExcel形式で出力

### 対応データ形式

**必須カラム:**
- `Order Date` - 注文日（日付形式）
- `Sales` - 売上（数値）
- `Profit` - 利益（数値）
- `Product Name` - 商品名（文字列）

**推奨カラム（グラフ機能が拡張されます）:**
- `Customer Name` - 顧客名
- `Region` - 地域
- `Category` - カテゴリ
- `Segment` - セグメント
- `Order ID` - 注文ID

---

## アプリケーションの起動

### 1. ターミナル/コマンドプロンプトを開く

**Windows:**
- スタートメニュー → 「cmd」または「PowerShell」で検索

**macOS:**
- Spotlight検索（⌘ + Space） → 「Terminal」

**Linux:**
- Ctrl + Alt + T

### 2. プロジェクトフォルダに移動

```bash
cd C:\Users\pc\Desktop\python\claude_code\sales_dashboard
```

### 3. 仮想環境を有効化（推奨）

```bash
# Windows
venv\Scripts\activate

# macOS/Linux
source venv/bin/activate
```

### 4. アプリケーションを起動

```bash
streamlit run app.py
```

### 5. ブラウザでアクセス

ブラウザが自動的に開き、`http://localhost:8501` でアプリが表示されます。

自動で開かない場合は、手動でブラウザに `http://localhost:8501` を入力してください。

---

## データのアップロード

### サンプルデータを使用する

初めて使う場合は、サンプルデータで動作確認できます。

1. サイドバーの「サンプルデータを使用」ボタンをクリック
2. Superstore Dataset（9994行、21列）が自動的に読み込まれます

### CSVファイルをアップロードする

#### 単一ファイル

1. サイドバーの「CSVファイルのアップロード」セクションへ
2. 「Browse files」ボタンをクリック
3. CSVファイルを選択

#### 複数ファイルの統合

複数のCSVファイルを一度にアップロードすると、自動的に統合されます。

1. 「Browse files」で複数ファイルを選択（Ctrl + クリックで複数選択）
2. アップロード完了後、自動的に統合処理が実行されます
3. サイドバーに「統合データ: XX行」と表示されます

**注意事項:**
- すべてのファイルが同じカラム構成である必要があります
- 重複行は自動的に削除されます
- エンコーディング（UTF-8/Shift-JIS/ISO-8859-1）は自動検出されます

### Excelファイルからデータを準備する

Excelファイル（.xlsx）は直接アップロードできません。以下の手順でCSVに変換してください：

1. Excelでファイルを開く
2. 「ファイル」→「名前を付けて保存」
3. 「ファイルの種類」で「CSV UTF-8（コンマ区切り）」を選択
4. 保存

---

## ダッシュボードの使い方

ダッシュボードタブでは、7種類のインタラクティブグラフが表示されます。

### 1. 月次売上推移

**表示内容:**
- 月ごとの売上の推移を折れ線グラフで表示

**操作方法:**
- グラフ上にマウスを置くと詳細データが表示されます
- ドラッグで拡大、ダブルクリックでリセット

### 2. 売上上位商品ランキング

**表示内容:**
- 売上の高い商品TOP10を横棒グラフで表示

**操作方法:**
- 商品名が長い場合は、マウスホバーで全文表示

### 3. 顧客分析（散布図）

**表示内容:**
- 顧客ごとの売上と利益の関係を散布図で表示
- バブルサイズ = 注文回数
- 色 = セグメント（Consumer/Corporate/Home Office）

**操作方法:**
- 点をクリックすると顧客名が表示されます
- 凡例をクリックしてセグメントの表示/非表示を切り替え

### 4. 地域別売上構成

**表示内容:**
- 地域ごとの売上割合を円グラフ（ドーナツチャート）で表示

**操作方法:**
- セクションにマウスを置くと割合と金額が表示されます

### 5. 前年同月比較

**表示内容:**
- 年ごとに月別売上を並べて比較（グループ化棒グラフ）

**操作方法:**
- 凡例をクリックして特定の年の表示/非表示を切り替え

### 6. カテゴリ別売上推移

**表示内容:**
- カテゴリごとの月別売上を積み上げ棒グラフで表示

**操作方法:**
- 凡例をクリックしてカテゴリの表示/非表示を切り替え

### 7. 商品別利益率分析

**表示内容:**
- 商品の売上と利益率の関係を散布図で表示
- 色：利益率（赤=低、緑=高）

**操作方法:**
- 点にマウスを置くと商品名と詳細データが表示されます

### グラフのエクスポート

各グラフの右上にあるツールバーから：
- カメラアイコン: PNG画像として保存
- 虫眼鏡アイコン: 拡大/縮小
- パンアイコン: グラフをドラッグ移動
- ホームアイコン: 表示をリセット

---

## データ確認タブ

アップロードしたデータの詳細を確認できます。

### データプレビュー

- 最初の20行を表形式で表示
- カラム名と各データ型を確認できます

### 基本統計量

`df.describe()`の結果を表示：
- count: データ件数
- mean: 平均値
- std: 標準偏差
- min/max: 最小値/最大値
- 25%/50%/75%: パーセンタイル

### Excelダウンロード

「Excelダウンロード」ボタンをクリックすると、統合されたデータをExcel形式（.xlsx）でダウンロードできます。

**ダウンロードされるファイル:**
- ファイル名: `sales_data_{日時}.xlsx`
- シート名: `Sales Data`
- 列幅は自動調整されます

---

## 売上予測タブ

線形回帰モデルで将来の売上を予測します。

### 予測の実行手順

#### 1. 予測期間を選択

ラジオボタンで以下から選択：
- **30日後** - 翌月予測
- **90日後** - 3ヶ月先予測
- **180日後** - 半年先予測
- **365日後** - 1年先予測

#### 2. 「予測実行」ボタンをクリック

処理が開始され、以下が表示されます：
- プログレスバー
- 「データ前処理中...」「モデル訓練中...」などのステータスメッセージ

#### 3. 予測結果の確認

**予測グラフ:**
- 青線: 実績（過去の売上）
- 紫線: 予測（将来の売上）

**精度評価指標:**

| 指標 | 説明 | 良い値 |
|------|------|--------|
| **RMSE** | 予測誤差の標準偏差 | 小さいほど良い |
| **MAE** | 予測誤差の平均 | 小さいほど良い |
| **R² スコア** | 説明力（0～1） | 1に近いほど良い |

**R²スコアの目安:**
- 0.9以上: 非常に良い
- 0.7～0.9: 良い
- 0.5～0.7: まあまあ
- 0.5未満: 精度が低い

### 予測精度を上げるには？

1. **データ量を増やす**: 最低100行、推奨300行以上
2. **期間を短くする**: 30日予測の方が365日予測より正確
3. **外れ値を除去**: データクリーニングで異常値を削除
4. **季節性のあるデータ**: 線形回帰は単純なトレンドのみ捉えるため、季節性が強い場合は精度が下がります

---

## PDFレポート生成タブ

モダンなデザインのPDFレポートを自動生成します。

### レポート生成手順

#### 1. 含めるグラフを選択

チェックボックスで選択：
- ☑ 月次売上推移
- ☑ 売上上位商品
- ☑ 地域別売上構成

**推奨**: 3つすべてにチェック

#### 2. 「レポート生成」ボタンをクリック

処理が開始され、以下のステータスメッセージが表示されます：
- 「月次売上推移グラフを生成中...」
- 「売上上位商品グラフを生成中...」
- 「地域別売上構成グラフを生成中...」
- 「PDFレポート作成中...」

#### 3. レポートをダウンロード

「PDFダウンロード」ボタンが表示されます。
- ファイル名: `sales_report_{日時}.pdf`
- サイズ: 約500KB～2MB

### PDFレポートの構成

**1ページ目: 表紙**
- タイトル
- 生成日時

**2ページ目: サマリー**
- 総売上
- 総利益
- 利益率
- データ期間

**3ページ目以降: グラフ**
- 選択したグラフが1ページに1つずつ配置

**最終ページ: データテーブル**
- 売上上位商品TOP10の数値表

### レポートが生成できない場合

**エラー: "kaleidoがインストールされていません"**

```bash
pip install kaleido==0.2.1
```

**エラー: "ディスク容量不足"**

不要なファイルを削除してディスク容量を確保してください。

---

## よくある質問（FAQ）

### Q1. CSVファイルが文字化けします

**A**: 以下を試してください：

1. **Excelで開いてUTF-8で保存し直す**
   - 「ファイル」→「名前を付けて保存」
   - 「CSV UTF-8（コンマ区切り）」を選択

2. **メモ帳で開いてエンコーディングを確認**
   - 右下に「UTF-8」「ANSI」などが表示されます
   - 「UTF-8」で保存し直してください

### Q2. 複数ファイルをアップロードしたら統合されませんでした

**A**: 以下を確認してください：

- すべてのCSVファイルが**同じカラム名**を持っているか
- カラムの順序が異なっていても統合できますが、カラム名は一致している必要があります

### Q3. グラフが表示されません

**A**: 以下を確認してください：

- ブラウザのJavaScriptが有効になっているか
- ブラウザのキャッシュをクリア（Ctrl + Shift + Delete）
- 別のブラウザ（Chrome、Firefox、Edge）で試してください

### Q4. 予測精度が低いです

**A**: 以下を確認してください：

- データ量: 最低100行、推奨300行以上
- データの品質: 欠損値や異常値が多くないか
- 予測期間: 短い期間（30日）の方が精度が高い
- データの特性: 季節性が強いデータは線形回帰では精度が低くなります

### Q5. PDFレポートにグラフが表示されません

**A**: kaleidoパッケージを再インストールしてください：

```bash
pip uninstall kaleido
pip install kaleido==0.2.1
```

### Q6. アプリが重い/遅いです

**A**: 以下を試してください：

- **データ量を減らす**: 10万行以上のデータは処理が遅くなります
- **ブラウザを再起動**: メモリ使用量がリセットされます
- **不要なタブを閉じる**: ブラウザの負荷を軽減

### Q7. サンプルデータが読み込めません

**A**: サンプルデータファイルが存在するか確認してください：

```bash
ls data/sample/Sample\ -\ Superstore.csv
```

ファイルが存在しない場合は、[Kaggle](https://www.kaggle.com/datasets/vivek468/superstore-dataset-final)からダウンロードしてください。

---

## トラブルシューティング

### エラーメッセージ別の対処法

#### "予測に必要なデータが不足しています"

**原因**: データ行数が100行未満

**対処法**: より長期間のデータをアップロードしてください。

---

#### "必須カラムが不足しています"

**原因**: CSVファイルに `Order Date`, `Sales`, `Profit`, `Product Name` のいずれかが欠けている

**対処法**:
1. CSVファイルのヘッダー行を確認
2. 必須カラムを追加
3. カラム名のスペルミスがないか確認（大文字小文字も区別されます）

---

#### "ファイルの読み込みに失敗しました"

**原因**: エンコーディングエラー、または破損したCSVファイル

**対処法**:
1. CSVファイルをUTF-8で保存し直す
2. Excelで開いて「名前を付けて保存」→「CSV UTF-8」を選択
3. ファイルが破損していないか確認（別のアプリで開けるか試す）

---

#### "データが空です"

**原因**: CSVファイルにヘッダー行しかない、またはデータ行が0行

**対処法**: データが含まれるCSVファイルをアップロードしてください。

---

#### "ディスク容量不足"

**原因**: PDFレポート生成時に一時ファイルを作成できない

**対処法**: 不要なファイルを削除してディスク容量を確保してください。

---

### アプリケーションをリセットする

アプリがおかしくなった場合は、ブラウザのキャッシュをクリアしてください：

**Chrome:**
1. Ctrl + Shift + Delete
2. 「キャッシュされた画像とファイル」をチェック
3. 「データを削除」

**Firefox:**
1. Ctrl + Shift + Delete
2. 「キャッシュ」をチェック
3. 「今すぐ消去」

---

## サポート

問題が解決しない場合は、以下をお試しください：

1. **GitHubのIssue**を確認: [Issues](https://github.com/your-repo/sales_dashboard/issues)
2. **ログを確認**: ターミナルに表示されるエラーメッセージをコピー
3. **新しいIssueを作成**: エラーメッセージとスクリーンショットを添付

---

**ユーザーガイドの最終更新日**: 2025-10-10
